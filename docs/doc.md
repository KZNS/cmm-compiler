# Cmm 编译器文档

本文档包含本项目编译器从词法分析到中间代码生成与执行，和最后ui的全部技术内容。

## 目录 <!-- omit in toc -->

- [Cmm 编译器文档](#cmm-编译器文档)
  - [1. 项目概述](#1-项目概述)
    - [1.1. 功能概述](#11-功能概述)
    - [1.2. 代码结构](#12-代码结构)
  - [2. 词法分析](#2-词法分析)
  - [3. 语法分析](#3-语法分析)
  - [4. 语义分析](#4-语义分析)
  - [5. 中间代码生成](#5-中间代码生成)
  - [6. 解释执行](#6-解释执行)
  - [7. 用户界面](#7-用户界面)

## 1. 项目概述

### 1.1. 功能概述

见 [README.md](../README.md)

### 1.2. 代码结构

项目主体分为两个部分，编译器/解释器部分和前端部分。  

```text
.
├── run.sh       启动脚本
├── compiler     编译器/解释器部分
└── webservice   前端UI部分
```

编译器部分：

```text
.
├── compiler.exe      编译器可执行文件
├── language.txt      词法规则
├── compiler.cpp      编译器入口
├── automaton.h       词法分析部分
├── automaton.cpp
├── translator.h      语法、语义部分
├── translator.cpp
├── symbol_table.h    符号表部分
├── symbol_table.cpp
└── cLogger           log模块
    ├── clogger.cpp
    └── clogger.h

```

UI部分：

```text
.
├── 1.cpp
├── app.py
├── notes.md
├── placeholder.png
├── requirements.txt
├── static
│   └── comp.js
└── templates
    └── index.html
```

## 2. 词法分析

## 3. 语法分析

## 4. 语义分析

## 5. 中间代码生成

通过查阅与参考相关资料我们设计了一种自定义的基于栈和符号表的中间代码pcode[]
…………

## 6. 解释执行

在生成中间代码后需要运行之。基于上文定义的简易中间代码文法，我们基于C++设计并实现了一个Pcode虚拟机。它包括运行时变量栈、运行时变量速查表、运行时全局变量速查表、运行时运算栈、标签表、函数表、代码表、运行时代码指针、运行时栈变量栈指针。  

Pcode的所有命令都是对运行时栈顶及其附近的元素进行操作的
……


## 7. 用户界面  

考虑到开发时间成本与表现力，我们选择了采用web技术来构建用户界面。 目前在开发人员间流行的Visual Studio Code也是通过web技术实现的。此外，在本课程设计项目中采用web技术还有便于演示的优势，web技术提供的跨平台支持可以解决可能存在的兼容性与依赖问题。  

在本项目的浏览器-服务器架构中用户提交的代码会在服务器端进行编译，翻译成中间代码pcode后解释执行，并把执行结果返回用户端。  

服务器端我们基于Python3.7选择了Flask框架进行开发，采用了uWSGI作为服务器，同时使用了Nginx反向代理。  

浏览器端我们采用了异步数据传输技术（AJAX）以提高用户体验，用户在提交代码后不会感受到页面阻塞，依旧能进行其他UI操作。  

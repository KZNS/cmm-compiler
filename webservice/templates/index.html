<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>test</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.59.0/lib/codemirror.min.css">

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.59.0/lib/codemirror.min.js"></script>
    <style>
        .model {
            height: calc(100% - 112px);
        }

        .left {
            width: 50%;
            height: 100%;
            float: left;
            background-color: black;
        }

        .right {
            width: 50%;
            height: 100%;
            float: right;
            background-color: antiquewhite;
        }

        .CodeMirror {
            border: 1px solid #eee;
            height: auto;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
        }

        .options {
            float: left;
        }

        .submit {
            float: right;
        }

        .textout {
            min-height: 400px;
        }
    </style>
</head>

<body>
    <div style="height: 100%;">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="">
            <a class="navbar-brand" href="/">CMM COMPILER</a>
        </nav>
        <div class="model">
            <div class="left"id="codeinput">
                <!-- 左半边
                <div contenteditable="plaintext-only" style="color:rgb(86,156,179)" onchange="handleChange()"
                    class="codeinput"  tabindex="-1" onkeydown="handlekeydown()">
                </div> -->
            </div>
            <div class="right">
                <!--右半边-->
                <div class="textout">
                    <h2>
                        输出
                    </h2>
                    <p id="outputContent">

                    </p>
                </div>
                <hr>
                <div class="imgout">
                    graph out
                    <img src="" alt="graph output" id="graph" style="display: none;height:200px">
                </div>
            </div>
        </div>
        <nav class="navbar navbar-expand-lg fixed-bottom navbar-light bg-light" style="height:56px;text-align:left">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <span style="float:left;">
                        <label>logging</label>
                        <input type="radio" name="loggingToggle" value="on" onchange="toggleLevel()">on
                        <input type="radio" name="loggingToggle" value="off" checked="checked"
                            onchange="toggleLevel()">off
                    </span>
                </li>
                <li class="nav-item" style="margin-left:10px;">
                    <span style="float:right;margin-right:10px;">
                        <select id="loggingLevel" style="display:none">
                            <option value="debug">debug</option>
                            <option value="info" selected="selected">info</option>
                            <option value="warn">warn</option>
                            <option value="error">error</option>
                            <option value="fatal">fatal</option>
                        </select>
                    </span>
                </li>

            </ul>
            <ul class="navbar-nav  ml-auto" style="margin-right:51%;">
                <li class="nav-item">

                    <span>
                        <button onclick="save()">保存</button>
                    </span>
                    <span>
                        <button onclick="submit()">提交</button>
                    </span>
                </li>
            </ul>

        </nav>
    </div>
    <script>
        var myCodeMirror = CodeMirror(document.getElementById("codeinput"), {
            value: "void main()\n{\nprintf(\"Hello CMM!\");\n}",
            mode: "javascript",
            lineNumbers: true,
        });
        toggleLevel = () => {
            $("#loggingLevel").toggle()
        }
        submit = () => {
            let codeinput = $("#codeinput").text()
            let logging = $('input[name="loggingToggle"]:checked').val();
            let loggingLevel = $("#loggingLevel").val()
            let result = {
                codeinput: codeinput,
                logging: logging,
                loggingLevel: loggingLevel
            }
            console.log(result)
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(result)
            }).then(res => res.json()).then(
                r => {
                    console.log(r)
                    $("#outputContent").text(r.data)
                    $("#graph").attr("src", r.img)
                    $("#graph").show()
                }
            ).catch(err => {
                console.log(err)
            })
        }
        handlekeydown = (e) => {
            console.log(e)
        }
    </script>
</body>

</html>